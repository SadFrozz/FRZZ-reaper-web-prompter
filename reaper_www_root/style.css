/* Общие стили */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: #222;
    color: #eee;
    margin: 0;
    padding: 1rem;
    /* Reserve space for mobile safe areas (iOS notch / Android gesture bar). JS may augment via inline style. */
    padding-top: calc(1rem + env(safe-area-inset-top, 0px) + var(--rvw-safe-top-extra, 0px));
    padding-bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
    box-sizing: border-box;
    overflow: hidden;
    --filter-dim-opacity: 0.4;
    --filter-dim-overlay-alpha: 0.6;
}
body.title-hidden h1 { display: none; }
.container { font-size: 0.75em; }
.modal-content { font-size: 1.333333em; }
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
.container { display: flex; flex-direction: column; height: calc(var(--rvw-vh, 100vh) - 2rem); gap: 1rem; }
#navigation-panel { flex-shrink: 0; background-color: #2e2e2e; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 0.125rem 0.3125rem rgba(0,0,0,0.3); order: 100; display: flex; flex-direction: column; gap: 0.8rem; overflow: hidden; max-height: 100vh; transition: max-height 0.28s ease, opacity 0.24s ease, transform 0.28s ease, padding-top 0.28s ease, padding-bottom 0.28s ease, margin-top 0.28s ease, margin-bottom 0.28s ease; }
#navigation-panel.top-panel { order: -1; }
.panel-header { display: flex; justify-content: space-between; align-items: baseline; padding-bottom: 0.5rem; border-bottom: 1px solid #444; }
h1 { margin: 0; flex-grow: 1; font-size: 2em; } 
#status-indicator { color: #888; text-align: right; font-size: 1.5em; }
.panel-controls { display: flex; align-items: center; gap: 1rem; flex-wrap: nowrap; }
/* Dynamic wrap mode: JS toggles .transport-wrapped when total width overflows.
    Only the transport block moves to the next line; left/right groups stay on first line. */
.panel-controls.transport-wrapped { flex-wrap: wrap; row-gap: 0.5rem; }
/* When wrapped: left/right tighten, transport full width second line */
.panel-controls.transport-wrapped .controls-left,
.panel-controls.transport-wrapped .controls-right { flex-basis: auto; min-width: 0; flex-shrink: 1; }
.panel-controls.transport-wrapped #transport-status { flex-basis: 100%; order: 3; justify-content: center; padding: 0; margin-top: 0.25rem; }
.panel-controls.transport-wrapped .controls-left { order: 1; }
.panel-controls.transport-wrapped .controls-right { order: 2; }
.controls-left { display: flex; align-items: center; gap: 0.5rem; flex: 0 1 auto; min-width: 0; }
.controls-right { display: flex; align-items: center; justify-content: flex-end; gap: 0.4rem; flex: 0 1 auto; min-width: 0; margin-inline-start: auto; }
#navigation-panel.compact-mode { flex-direction: row; align-items: center; gap: 0.75rem; padding: 0.75rem; }
#navigation-panel.compact-mode .panel-header { display: none; }
#navigation-panel.compact-mode .panel-controls { flex: 1 1 auto; gap: 0.5rem; flex-wrap: wrap; justify-content: space-between; }
#navigation-panel.compact-mode .controls-left { gap: 0.35rem; }
#navigation-panel.compact-mode .controls-right { gap: 0.5rem; margin-inline-start: 0; }
#navigation-panel.compact-mode #transport-status { margin: 0; padding: 0; }
#navigation-panel.nav-panel-animating { display: flex !important; }
#navigation-panel.nav-panel-animating .panel-header,
#navigation-panel.nav-panel-animating .panel-controls { transition: opacity 0.2s ease; }
#navigation-panel.nav-panel-hidden { opacity: 0; transform: translateY(-0.75rem); max-height: 0; padding-top: 0; padding-bottom: 0; margin-top: 0; margin-bottom: 0; pointer-events: none; }
#navigation-panel.nav-panel-hidden .panel-header,
#navigation-panel.nav-panel-hidden .panel-controls { opacity: 0; }
#navigation-panel.is-collapsed { display: none !important; }
body.nav-panel-collapsed #text-display-wrapper { padding-bottom: 4.5rem; }
body.nav-panel-collapsed .navigation-floating-controls { pointer-events: auto; }
#navigation-panel label, #navigation-panel select { font-size: 1.5em; }
#track-selector { padding: 0.5em; background-color: #333; color: #eee; border: 1px solid #555; border-radius: 0.25rem; }
#refresh-button, #settings-button, #save-settings-button, #actors-button, #stats-button, #navigation-compact-toggle, #navigation-fullscreen-toggle { padding: 0.4em; line-height: 1; background-color: #4a4a4a; color: #eee; border: none; border-radius: 0.25rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1.5em; }
#refresh-button:hover, #settings-button:hover, #save-settings-button:hover, #actors-button:hover, #stats-button:hover, #navigation-compact-toggle:hover, #navigation-fullscreen-toggle:hover { background-color: #5a5a5a; }
.icon-svg { width: 1.2rem; height: 1.2rem; fill: currentColor; }
#navigation-panel .track-selector-label {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: default;
    pointer-events: none;
    color: inherit;
    background: none;
    border: none;
    padding: 0;
    line-height: 0;
    font-size: 1em;
}
#navigation-panel .track-selector-label .track-selector-icon {
    width: 1.6rem;
    height: 1.6rem;
}
#navigation-compact-toggle { min-width: 2.25rem; }
#navigation-compact-toggle .icon-expand { display: none; }
#navigation-compact-toggle.is-collapsed .icon-collapse { display: none; }
#navigation-compact-toggle.is-collapsed .icon-expand { display: inline; }
#navigation-fullscreen-toggle { min-width: 2.25rem; }
#navigation-fullscreen-toggle .icon-exit { display: none; }
#navigation-fullscreen-toggle.is-active .icon-enter { display: none; }
#navigation-fullscreen-toggle.is-active .icon-exit { display: inline; }
.navigation-floating-controls #navigation-floating-fullscreen .icon-exit { display: none; }
.navigation-floating-controls #navigation-floating-fullscreen.is-active .icon-enter { display: none; }
.navigation-floating-controls #navigation-floating-fullscreen.is-active .icon-exit { display: inline; }
.navigation-floating-controls {
    position: fixed;
    right: calc(1.5rem + env(safe-area-inset-right, 0px));
    bottom: calc(1.5rem + env(safe-area-inset-bottom, 0px));
    transform: translateY(130%);
    display: flex;
    align-items: stretch;
    gap: 0.4rem;
    padding: 0.35rem 0.5rem;
    border-radius: 0.5rem;
    background: rgba(46, 46, 46, 0.95);
    box-shadow: 0 0.75rem 1.75rem rgba(0, 0, 0, 0.35);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 950;
    overflow: hidden;
}
.navigation-floating-controls.is-visible {
    opacity: 1;
    transform: translateY(0);
}
.navigation-floating-controls button {
    padding: 0.4rem;
    border: none;
    border-radius: 0.35rem;
    background-color: #4a4a4a;
    color: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-size: 1.5em;
    min-width: 2.25rem;
}
.navigation-floating-controls button:hover {
    background-color: #5a5a5a;
}
.light-theme .navigation-floating-controls {
    background: rgba(255, 255, 255, 0.96);
    box-shadow: 0 0.75rem 1.75rem rgba(0, 0, 0, 0.2);
}
.light-theme .navigation-floating-controls button {
    background-color: rgba(0, 0, 0, 0.12);
    color: #222;
}
.light-theme .navigation-floating-controls button:hover {
    background-color: rgba(0, 0, 0, 0.22);
}
#transport-status { flex: 0 0 auto; display: flex; align-items: center; justify-content: center; gap: 0.5em; font-family: monospace; font-weight: bold; padding: 0 1em; transition: color 0.3s; font-size: 2.2em; margin: auto; }
#transport-icon-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.4em;
    height: 1.4em;
}
#transport-icon-container .icon-svg { display: none; }
#transport-timecode { letter-spacing: 0.1rem; cursor: pointer; transition: color 0.2s; }
#transport-timecode:hover { color: #ffc107; }
body.transport-timecode-hidden #transport-status { display: none; }
#transport-progress-container { display: none; flex-basis: 100%; height: 0.3125rem; background-color: #555; border-radius: 0.1875rem; overflow: hidden; }
#transport-progress-bar { width: 100%; height: 100%; background-color: #ffc107; transform-origin: left; transform: scaleX(0); transition: transform 0.1s linear; }
body.progress-mode-timecode #transport-status { flex-wrap: wrap; gap: 0.35em; }
body.progress-disabled #transport-progress-container { display: none !important; }
.light-theme #transport-progress-container { background-color: #d0d0d0; }
.status-stop { color: #eee; }
.status-stop #icon-stop { display: block; }
.status-play { color: #4CAF50; }
.status-play #icon-play { display: block; }
.status-record { color: #F44336; }
.status-record #icon-record { display: block; }
main { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; background-color: #1e1e1e; border-radius: 0.5rem; box-shadow: 0 0.125rem 0.3125rem rgba(0,0,0,0.3); order: 0; }
#text-display-wrapper { flex-grow: 1; overflow-y: auto; will-change: scroll-position; }
#text-display { padding: 1em 0.5em; font-size: 2em; line-height: 1.4; }
.subtitle-container { display: flex; align-items: center; padding: 0 0.5em; border-radius: 0.25rem; transition: background-color 0.3s, color 0.3s; position: relative; }
.subtitle-container::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: rgba(0, 0, 0, var(--filter-dim-overlay-alpha, 0.6));
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    /* Overlay keeps dimming visible above highlight backgrounds */
}
.subtitle-container.filter-dimmed::after {
    opacity: 1;
}
.subtitle-container.filter-active { transition: background-color 0.3s, color 0.3s, opacity 0.3s ease; }
.subtitle-container.filter-hidden { display: none !important; }
.subtitle-time { min-width: 8.5rem; font-size: 1em; color: #ccc; text-align: right; font-family: monospace; padding: 0.3em 0.4em 0.65em; order: 0; display: inline-flex; align-items: center; justify-content: flex-end; position: relative; }
.subtitle-time .overlap-indicator {
    display: none !important;
    width: 0;
    margin: 0;
    padding: 0;
}
.subtitle-time-label { flex: 1 1 auto; text-align: left; white-space: nowrap; }
.subtitle-time-progress { position: absolute; left: 0.4em; right: 0.4em; bottom: 0.22em; height: 0.22rem; background-color: #ffc107; border-radius: 0.1875rem; transform-origin: left; transform: scaleX(0); transition: transform 0.1s linear, opacity 0.15s ease-in-out; opacity: 0; pointer-events: none; }
.subtitle-time.has-time-progress .subtitle-time-progress { opacity: 1; }
.columns-swapped .subtitle-time { justify-content: flex-end; }
.role-area { display: flex; align-items: stretch; order: 2; }
.columns-swapped .subtitle-time { order: 3; }
.columns-swapped .role-area { order: 1; }
.columns-swapped .subtitle-color-swatch.column-swatch { order: 1; }
.columns-swapped .subtitle-role:not(.inline-role) { order: 2; }
.columns-swapped .subtitle-separator { order: 3; }
.columns-swapped .subtitle-time::after { content: ''; width: 0.5rem; height: 2em; background-color: #555; margin-left: 1.5rem; border-radius: 0.25rem; }
.subtitle-color-swatch { width: 1.875rem; height: auto; margin-right: 0.5rem; border-radius: 0.25rem; flex-shrink: 0; }
.subtitle-color-swatch.column-swatch { order: 1; }
body[data-role-style='column_with_swatch'] .subtitle-color-swatch { width: 0; margin-right: 0; }
/* Compact swatch mode when role text not shown in a separate column (inline or hidden) */
.has-inline-swatch .subtitle-color-swatch { width: 0.875rem; margin-right: 0.5rem; border-radius: 0.1875rem; order: initial; }
.has-inline-swatch .subtitle-role { display: none; }
/* ++ ИЗМЕНЕНО: Добавлено правило visibility для исправления разметки ++ */
.subtitle-role, .subtitle-color-swatch { transition: visibility 0s; }
.role-hidden { visibility: hidden; }
.subtitle-role { flex-shrink: 0; padding: 0.2em 0.5em; margin-right: 1.5em; text-align: right; color: #ccc; border-radius: 0.25rem; word-break: break-all; overflow-wrap: break-word; display: flex; align-items: center; justify-content: flex-end; }
.subtitle-role:not(.inline-role) { order: 2; }
.subtitle-separator { width: 0.5rem; height: auto; background-color: #555; margin-right: 0.5em; border-radius: 0.25rem; align-self: center; min-height: 2em; order: 3; }
.subtitle-content { flex: 1; display: flex; flex-direction: column; order: 5; align-self: center; padding-bottom: 0.8125rem; }
.subtitle-content.has-progress { padding-bottom: 0; }
.subtitle-content.has-progress .subtitle-progress-container { opacity: 1 !important; }
.subtitle-text { flex: 1; font-size: 0.9em; }
.subtitle-progress-container { height: 0.3125rem; background-color: #555; border-radius: 0.1875rem; margin-top: 0.5rem; opacity: 0; transition: opacity 0.15s ease-in-out; }
.subtitle-progress-bar { height: 100%; width: 100%; background-color: #ffc107; border-radius: 0.1875rem; transform-origin: left; transform: scaleX(0); transition: transform 0.1s linear; }
.current-line .subtitle-progress-container { opacity: 1 !important; }
.overlap-block {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0;
    margin: 0.55rem 0;
    padding: 0.35rem 0;
    border-radius: 0.5rem;
    background-color: var(--frzz-overlap-fill, rgba(255, 112, 67, 0.08));
    box-shadow: 0 0 0 0.125rem var(--frzz-overlap-outline, rgba(255, 112, 67, 0.45));
    transition: box-shadow 0.2s ease, background-color 0.2s ease;
    overflow: visible;
}
.overlap-block::before {
    content: '';
    position: absolute;
    top: 0.35rem;
    bottom: 0.35rem;
    left: calc(-0.4rem - 0.125rem);
    width: 0.28rem;
    border-radius: 0.18rem;
    background: var(--frzz-overlap-stripe, rgba(255, 112, 67, 0.75));
    opacity: var(--frzz-overlap-stripe-opacity, 1);
    transition: background 0.2s ease, opacity 0.2s ease;
}
body.overlap-highlight-disabled .overlap-block {
    background-color: transparent;
    box-shadow: none;
}
body.overlap-highlight-disabled .overlap-block::before {
    opacity: 0;
}
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.6); }
.modal-content { background-color: #2f2f2f; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 37.5rem; border-radius: 0.5rem; position: relative; font-size: 0.85em; }
.modal-close-button { color: #aaa; position: absolute; top: 0.625rem; right: 1.25rem; font-size: 1.75rem; font-weight: bold; cursor: pointer; }
.modal-close-button:hover, .modal-close-button:focus { color: white; text-decoration: none; }
.setting-item input[type="text"], .setting-item input[type="number"], .setting-item select {
    padding: 0.5em;
    background-color: #333;
    color: #eee;
    border: 1px solid #555;
    border-radius: 4px;
    flex: 0 1 clamp(10rem, 50%, 18rem);
    max-width: clamp(10rem, 50%, 18rem);
    width: 100%;
    font-size: inherit;
}
.setting-item .short-input { flex-basis: 25%; }
.settings-body { margin-top: 1.25rem; border-top: 1px solid #444; padding-top: 1.25rem; }
fieldset { border: 1px solid #555; border-radius: 0.5rem; padding: 0.5rem 1rem 1rem; margin-bottom: 1rem; }
legend { padding: 0 0.5em; color: #ccc; font-weight: bold; }
/* Collapsible fieldsets */
.fieldset-collapsible > legend { cursor: pointer; position: relative; padding-left: 1.1em; }
.fieldset-collapsible > legend:before { content: '\25BC'; position: absolute; left: 0; top: 0; font-size: 0.9em; transition: transform 0.2s; }
.fieldset-collapsible.collapsed > legend:before { transform: rotate(-90deg); }
.fieldset-collapsible.collapsed > *:not(legend) { display: none !important; }

/* Checkerboard paired layout */
.checkerboard-pair-row { display: flex; gap: 1.25rem; margin-bottom: 0.75rem; flex-wrap: nowrap; }
.checkerboard-pair-row.wrap { flex-wrap: wrap; }
.checkerboard-cell { flex: 1; display: flex; align-items: center; gap: 0.6rem; min-width: 0; }
.checkerboard-cell.responsive { flex: 1 1 15rem; }
/* Each cell becomes a horizontal flex row: label | input+button */
/* (moved above + extended) */
.checkerboard-cell > label { flex: 0 0 auto; white-space: nowrap; font-size: 0.95em; }
.checkerboard-cell .input-with-button { margin-left: auto; flex: 0 0 auto; display: flex; align-items: center; gap: 0.4rem; }
.checkerboard-cell .input-with-button input[type="text"] { flex: 0 0 auto; width: 70px; min-width: 70px; padding: 0.35em 0.5em; background-color: #333; color: #eee; border: 1px solid #555; border-radius: 4px; font-size: inherit; }
.checkerboard-cell .copy-color-btn { height: 2.1rem; width: 2.1rem; padding: 0; }
.role-options-wrapper { display: contents; }
.role-options-wrapper.is-hidden { display: none; }
.checkerboard-options-wrapper { display: contents; }
.checkerboard-options-wrapper.is-hidden { display: none; }
.setting-group-title { font-weight: bold; margin: 0.5rem 0 1rem; color: #ccc; }
hr { border: none; height: 1px; background-color: #444; margin: 1.5rem 0; }
.setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
.setting-item-vertical { display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem; margin-bottom: 1rem; }
.setting-item-vertical input[type="text"] { width: 100%; box-sizing: border-box; font-size: inherit; }
.setting-item label { flex-grow: 1; margin-right: 0.625rem; }
.setting-item input[type="range"] {
    /* Width subtracts value badge (2.5rem) plus gap (0.3125rem) */
    flex: 0 1 calc(clamp(10rem, 50%, 18rem) - 2.8125rem);
    max-width: calc(clamp(10rem, 50%, 18rem) - 2.8125rem);
    min-width: calc(10rem - 2.8125rem);
    cursor: pointer;
    margin-left: 0;
}
.setting-item span { min-width: 2.5rem; text-align: right; font-family: monospace; margin-left: 0.3125rem; }
.setting-item-grid { display: grid; grid-template-columns: auto 1fr auto 1fr; gap: 0.5rem 1rem; align-items: center; margin-bottom: 1rem; }
.setting-item input[type="color"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 100%; height: 2rem; background-color: transparent; border: 1px solid #555; border-radius: 4px; cursor: pointer; }
.setting-item input[type="color"]::-webkit-color-swatch { border-radius: 3px; border: none; }
.setting-item input[type="color"]::-moz-color-swatch { border-radius: 3px; border: none; }
input[type="checkbox"] {
    --toggle-width: 2.6rem;
    --toggle-height: 1.3rem;
    --toggle-padding: 0.16rem;
    -webkit-appearance: none;
    appearance: none;
    width: var(--toggle-width);
    height: var(--toggle-height);
    border-radius: var(--toggle-height);
    background-color: #555;
    border: 1px solid rgba(0, 0, 0, 0.55);
    position: relative;
    display: inline-block;
    flex-shrink: 0;
    cursor: pointer;
    transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    vertical-align: middle;
}
input[type="checkbox"]::after {
    content: "";
    position: absolute;
    width: calc(var(--toggle-height) - var(--toggle-padding) * 2);
    height: calc(var(--toggle-height) - var(--toggle-padding) * 2);
    border-radius: 50%;
    background-color: #fff;
    top: 50%;
    left: var(--toggle-padding);
    transform: translate(0, -50%);
    transition: transform 0.2s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.35);
}
input[type="checkbox"]:checked {
    background-color: #4aa8ff;
    border-color: rgba(32, 112, 185, 0.75);
}
input[type="checkbox"]:checked::after {
    transform: translate(calc(var(--toggle-width) - var(--toggle-height)), -50%);
}
input[type="checkbox"]:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 168, 255, 0.35);
}
input[type="checkbox"]:disabled {
    cursor: not-allowed;
    opacity: 0.6;
    background-color: #3a3a3a;
    border-color: rgba(0, 0, 0, 0.4);
}
input[type="checkbox"]:disabled::after {
    box-shadow: none;
}
.light-theme input[type="checkbox"] {
    background-color: #c9c9c9;
    border-color: rgba(0, 0, 0, 0.2);
}
.light-theme input[type="checkbox"]:checked {
    background-color: #0d66d0;
    border-color: rgba(10, 70, 140, 0.5);
}
.light-theme input[type="checkbox"]:focus-visible {
    box-shadow: 0 0 0 3px rgba(13, 102, 208, 0.35);
}
input[type="checkbox"]:active::after {
    transition-duration: 0.12s;
}
.scroll-caption { font-size: 0.9em; color: #bbb; text-align: center; width: 100%; margin-top: 0.5rem; }
.scroll-caption:empty { display: none; }
.hide-empty-role-column .role-area-is-empty { display: none; }
.light-theme { background-color: #e0e0e0; color: #111; }
.light-theme #navigation-panel { background-color: #f5f5f5; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
.light-theme .panel-header { border-bottom: 1px solid #ccc; }
.light-theme h1 { color: #000; }
.light-theme #status-indicator { color: #666; }
.light-theme #track-selector { background-color: #e9e9e9; color: #111; border: 1px solid #ccc; }
.light-theme #refresh-button, .light-theme #settings-button, .light-theme #save-settings-button, .light-theme #actors-button, .light-theme #stats-button, .light-theme #navigation-compact-toggle, .light-theme #navigation-fullscreen-toggle { background-color: #dcdcdc; color: #333; }
.light-theme #refresh-button:hover, .light-theme #settings-button:hover, .light-theme #save-settings-button:hover, .light-theme #actors-button:hover, .light-theme #stats-button:hover, .light-theme #navigation-compact-toggle:hover, .light-theme #navigation-fullscreen-toggle:hover { background-color: #cecece; }
.light-theme #navigation-panel .track-selector-label { color: #1C274C; }
.light-theme #transport-status.status-stop { color: #111; }
.light-theme #transport-status.status-play { color: #28a745; }
.light-theme #transport-status.status-record { color: #dc3545; }
.light-theme main { background-color: #ffffff; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
.light-theme #text-display { background-color: #fdfdfd; }
.light-theme .subtitle-time { color: #555; }
.light-theme .subtitle-role { color: #444; }
.light-theme .subtitle-separator { background-color: #ccc; }
.light-theme .columns-swapped .subtitle-time::after { background-color: #ccc; }
.light-theme .subtitle-time .overlap-indicator { display: none !important; }
.light-theme .modal-content { background-color: #fefefe; border: 1px solid #ccc; }
.light-theme .modal-close-button { color: #888; }
.light-theme .modal-close-button:hover, .light-theme .modal-close-button:focus { color: #000; }
.light-theme .settings-body { border-top: 1px solid #ccc; }
.light-theme fieldset { border-color: #ccc; }
.light-theme legend, .light-theme .setting-group-title { color: #333; }
.light-theme hr { background-color: #ccc; }
.light-theme .setting-item input[type="text"], .light-theme .setting-item input[type="number"], .light-theme .setting-item select { background-color: #e9e9e9; color: #111; border: 1px solid #ccc; }
.light-theme .setting-item input[type="color"] { border: 1px solid #ccc; }

/* Стили для кастомного color picker'а */
.setting-item .sp-replacer { padding: 0; background: transparent; border: 0; display: flex; align-items: center; }
.setting-item .sp-preview { width: 2.5rem; height: 2.5rem; border-radius: 4px; border: 1px solid #555; margin-right: 0.5rem; }
.setting-item .sp-preview-inner, .setting-item .sp-alpha-inner { border-radius: 3px; }
.setting-item .sp-input { background-color: #333; color: #eee; border: 1px solid #555; border-radius: 4px; padding: 0.5em; width: 70px; font-size: inherit; }
.light-theme .setting-item .sp-preview { border-color: #ccc; }
.light-theme .setting-item .sp-input { background-color: #e9e9e9; color: #111; border-color: #ccc; }
.sp-original-input-container input { width: 70px; }
.input-with-button { display: flex; align-items: center; margin-left: auto; gap: 0.5rem; }

/* Unified inline color-row layout for highlight section (current line) */
.setting-group-inline-colors { display: flex; flex-wrap: wrap; gap: 1.25rem 2rem; align-items: flex-start; margin-bottom: 1rem; }
.setting-group-inline-colors .setting-item { margin: 0; min-width: 10rem; flex: 1 1 auto; display: flex; align-items: center; gap: 0.6rem; }
.setting-group-inline-colors .setting-item .input-with-button { flex: 0 0 auto; margin-left: auto; }
.setting-group-inline-colors .setting-item input[type="text"] { width: 3rem; min-width: 3rem; font-size: inherit; }
/* Header flex for click highlight section */
.setting-group-header-flex { display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-bottom: 1rem; }
.setting-group-header-flex .setting-group-title { margin: 0; }
.inline-checkbox { display: flex; align-items: center; gap: 0.5rem; }
.inline-checkbox input[type="checkbox"] { margin: 0; }

/* Dual-range slider for auto-scroll window */
.dual-range {
    --dual-thumb-size: 1.05rem;
    --dual-track-height: 0.45rem;
    --track-base-color: #555;
    --track-active-color: #4aa8ff;
    position: relative;
    width: 100%;
}

/* Shared themed slider appearance */
.frzz-slider {
    --frzz-slider-thumb-size: 1.05rem;
    --frzz-slider-track-height: 0.45rem;
    --frzz-slider-track-color: #555;
    --frzz-slider-active-color: #4aa8ff;
    --frzz-slider-stop: 50%;
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    border-radius: 999px;
    background:
        linear-gradient(var(--frzz-slider-active-color), var(--frzz-slider-active-color)) left center/var(--frzz-slider-stop) var(--frzz-slider-track-height) no-repeat,
        linear-gradient(var(--frzz-slider-track-color), var(--frzz-slider-track-color)) center/100% var(--frzz-slider-track-height) no-repeat;
    cursor: pointer;
    outline: none;
}
.frzz-slider:focus {
    outline: none;
}
.frzz-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: var(--frzz-slider-thumb-size);
    height: var(--frzz-slider-thumb-size);
    border-radius: 50%;
    background: var(--frzz-slider-active-color);
    border: 2px solid rgba(18, 18, 18, 0.7);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.15);
    margin-top: calc((var(--frzz-slider-thumb-size) - var(--frzz-slider-track-height)) * -0.5);
    cursor: pointer;
}
.frzz-slider::-webkit-slider-runnable-track {
    height: var(--frzz-slider-track-height);
    background: transparent;
    border-radius: 999px;
}
.frzz-slider::-moz-range-thumb {
    width: var(--frzz-slider-thumb-size);
    height: var(--frzz-slider-thumb-size);
    border-radius: 50%;
    border: 2px solid rgba(18, 18, 18, 0.7);
    background: var(--frzz-slider-active-color);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.15);
    cursor: pointer;
}
.frzz-slider::-moz-range-track {
    height: var(--frzz-slider-track-height);
    background: var(--frzz-slider-track-color);
    border: none;
    border-radius: 999px;
}
.frzz-slider::-moz-range-progress {
    height: var(--frzz-slider-track-height);
    background: var(--frzz-slider-active-color);
    border-radius: 999px;
}
.frzz-slider::-ms-track {
    height: var(--frzz-slider-track-height);
    background: transparent;
    border-color: transparent;
    color: transparent;
}
.frzz-slider::-ms-fill-lower {
    background: var(--frzz-slider-active-color);
    border-radius: 999px;
}
.frzz-slider::-ms-fill-upper {
    background: var(--frzz-slider-track-color);
    border-radius: 999px;
}

.light-theme .frzz-slider {
    --frzz-slider-track-color: #c9c9c9;
    --frzz-slider-active-color: #0d66d0;
}
.light-theme .frzz-slider::-webkit-slider-thumb,
.light-theme .frzz-slider::-moz-range-thumb {
    border-color: rgba(240, 240, 240, 0.8);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
}
.dual-range input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    margin: 0;
    background: transparent;
    pointer-events: none;
}
.dual-range input[type="range"]:focus {
    outline: none;
}
.dual-range input[type="range"]:first-of-type {
    z-index: 3;
}
.dual-range input[type="range"]:last-of-type {
    z-index: 2;
}
.dual-range input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: var(--dual-thumb-size);
    height: var(--dual-thumb-size);
    border-radius: 50%;
    background: #4aa8ff;
    border: 2px solid rgba(18, 18, 18, 0.7);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.15);
    pointer-events: auto;
    cursor: pointer;
    margin-top: calc((var(--dual-thumb-size) - var(--dual-track-height)) * -0.5);
}
.dual-range input[type="range"]::-webkit-slider-runnable-track {
    height: var(--dual-track-height);
    background: transparent;
}
.dual-range input[type="range"]::-moz-range-thumb {
    width: var(--dual-thumb-size);
    height: var(--dual-thumb-size);
    border-radius: 50%;
    border: 2px solid rgba(18, 18, 18, 0.7);
    background: #4aa8ff;
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.15);
    pointer-events: auto;
    cursor: pointer;
    margin-top: calc((var(--dual-thumb-size) - var(--dual-track-height)) * -0.5);
}
.dual-range input[type="range"]::-moz-range-track {
    height: var(--dual-track-height);
    background: transparent;
    border: none;
}
.dual-range input[type="range"]::-moz-range-progress {
    background: transparent;
}
.dual-range input[type="range"]::-ms-track {
    height: var(--dual-track-height);
    background: transparent;
    border-color: transparent;
    color: transparent;
}
.dual-range input[type="range"]::-ms-fill-lower,
.dual-range input[type="range"]::-ms-fill-upper {
    background: transparent;
}
.dual-range-track {
    position: absolute;
    top: 50%;
    left: calc(var(--dual-thumb-size) / 2);
    right: calc(var(--dual-thumb-size) / 2);
    transform: translateY(-50%);
    width: auto;
    height: var(--dual-track-height);
    border-radius: 999px;
    background: var(--track-base-color, #555);
    pointer-events: none;
    z-index: 1;
}
.dual-range-track::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: calc(var(--range-start, 0) * 1%);
    width: max(0%, calc((var(--range-end, 0) - var(--range-start, 0)) * 1%));
    border-radius: inherit;
    background: var(--track-active-color, #4aa8ff);
}
.setting-range {
    display: flex;
    align-items: center;
    flex: 1;
    gap: 0.6rem;
}
.setting-range input[type="range"] {
    flex: 1;
    margin-left: 0;
}
.setting-range.with-side-values {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 0.6rem;
}
.setting-range.with-side-values span {
    font-family: monospace;
    font-size: 0.95em;
    min-width: 3.5ch;
}
.setting-range.with-side-values #auto-scroll-window-top-value {
    text-align: left;
}
.setting-range.with-side-values #auto-scroll-window-bottom-value {
    text-align: right;
}

#auto-scroll-window-top-value,
#auto-scroll-window-bottom-value,
#scroll-speed-value,
#auto-scroll-line-anchor-value {
    display: inline-block;
    font-family: monospace;
    font-size: 0.95em;
    color: #bbb;
}
#scroll-speed-value,
#auto-scroll-line-anchor-value,
#auto-scroll-window-bottom-value {
    text-align: right;
    min-width: 3.5ch;
}
#auto-scroll-window-top-value {
    min-width: 3.5ch;
}
.light-theme .dual-range input[type="range"]::-webkit-slider-thumb {
    background: #0d66d0;
    border-color: rgba(240, 240, 240, 0.8);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
}
.light-theme .dual-range input[type="range"]::-moz-range-thumb {
    background: #0d66d0;
    border-color: rgba(240, 240, 240, 0.8);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
}

.light-theme .dual-range {
    --track-base-color: #c9c9c9;
    --track-active-color: #0d66d0;
}

/* Reusable tiled layout for settings sections */
.settings-tile-grid {
    display: grid;
    gap: 0.75rem 1.25rem;
    grid-template-columns: repeat(auto-fit, minmax(15rem, 1fr));
    align-items: start;
}
.settings-tile {
    padding: 0.55rem 0.75rem;
    border: 1px solid #3a3a3a;
    border-radius: 0.5rem;
    background: rgba(255, 255, 255, 0.03);
    display: flex;
    flex-direction: column;
    gap: 0.7rem;
    min-width: 0;
    width: 100%;
    box-sizing: border-box;
    margin: auto;
}
.settings-tile > *:last-child {
    margin-bottom: 0;
}
.settings-tile .setting-item,
.settings-tile .setting-item-vertical,
.settings-tile .setting-group {
    margin: 0.5rem 0rem;
}
.settings-tile .setting-group > *:last-child {
    margin-bottom: 0;
}
.settings-tile .setting-inline-row {
    margin-bottom: 0;
}
.settings-tile hr {
    margin: 0.75rem 0;
    width: 100%;
    align-self: stretch;
}
.light-theme .settings-tile hr {
    background-color: #ccc;
}
.role-settings-tiles .settings-tile,
.checkerboard-settings-tiles .settings-tile,
.highlight-settings-tiles .settings-tile {
    gap: 0.6rem;
}
.role-settings-tiles #role-options-wrapper {
    gap: 0.6rem;
}
.setting-item.setting-inline-color { gap: 0.6rem; }
.setting-item.setting-inline-color label { margin-right: 0.625rem; white-space: nowrap; }
.setting-item.setting-inline-color .input-with-button { margin-left: auto; }
.highlight-settings-tiles .setting-group-title { margin-top: 0; }
.highlight-settings-tiles .setting-group-inline-colors {
    width: 100%;
}
.highlight-tile-options { display: flex; flex-direction: column; gap: 0.6rem; }
#auto-scroll-mode-card {
    min-width: 15rem;
}
#auto-scroll-mode-card select {
    width: 100%;
}
.general-settings-tiles {
    grid-template-columns: repeat(auto-fit, minmax(15rem, 1fr));
}
.settings-tile select,
.settings-tile input[type="number"],
.settings-tile input[type="text"] {
    width: 100%;
    padding: 0.5rem;
    background-color: #333;
    color: #eee;
    border: 1px solid #555;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: inherit;
}
.light-theme .settings-tile select,
.light-theme .settings-tile input[type="number"] {
    background-color: #e9e9e9;
    color: #111;
    border-color: #ccc;
}
.settings-tile label {
    font-weight: 600;
}
.settings-tile-title {
    font-weight: 600;
    margin: 0;
    display: block;
}
.settings-tile-slider {
    gap: 0.75rem;
}
.settings-slider-row {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 0.5rem;
}
.settings-slider-row .frzz-slider {
    width: 100%;
    margin: 0;
}
.filter-dim-controls {
    display: flex;
    flex-direction: column;
    gap: 0.55rem;
}
.filter-dim-controls.is-hidden {
    display: none;
}
.settings-slider-value {
    min-width: 3.5ch;
    font-family: monospace;
    text-align: right;
}
.settings-slider-caption {
    margin: 0;
    font-size: 0.9em;
    color: #bbb;
}
.settings-helper-text {
    margin: 0;
    font-size: 0.9em;
    color: #bbb;
}
.light-theme .settings-helper-text {
    color: #4a4a4a;
}
.settings-tile .setting-range {
    width: 100%;
}
.settings-tile .scroll-caption {
    text-align: left;
    margin: 0.5rem 0rem;
}
.settings-tile .setting-group-title {
    margin: 0.5rem 0rem;
}
.settings-tile .setting-group-header-flex {
    margin-bottom: 0rem;
}

#auto-scroll-window-wrapper {
    order: 2;
}
#scroll-speed-wrapper {
    order: 3;
}
#auto-scroll-dynamic-speed-tile {
    order: 4;
}
#auto-scroll-line-anchor-wrapper {
    order: 5;
}

body[data-auto-scroll-mode="line"] #auto-scroll-line-anchor-wrapper {
    order: 3;
}
body[data-auto-scroll-mode="line"] #scroll-speed-wrapper {
    order: 4;
}
body[data-auto-scroll-mode="line"] #auto-scroll-dynamic-speed-tile {
    order: 5;
}

@media (min-width: 720px) {
    .settings-tile-grid {
        grid-template-columns: repeat(2, minmax(15rem, 1fr));
    }
    #general-settings-tiles {
        grid-template-columns: repeat(2, minmax(15rem, 1fr));
    }
}
.auto-scroll-advanced .setting-inline-row {
    margin-bottom: 0;
}
.setting-inline-row.tight {
    gap: 1rem;
    flex-wrap: nowrap;
}
.setting-inline-row.tight .setting-item {
    margin-bottom: 0;
    flex: 1 1 0;
    min-width: 0;
}
.setting-inline-row.tight .setting-item input {
    flex: 1 1 auto;
}
.setting-item-vertical input[type="range"] {
    width: 100%;
}

.light-theme .dual-range-track {
    background: var(--track-base-color, #c9c9c9);
}
.light-theme .dual-range-track::before {
    background: var(--track-active-color, #0d66d0);
}
.light-theme #auto-scroll-window-top-value,
.light-theme #auto-scroll-window-bottom-value,
.light-theme #scroll-speed-value,
.light-theme #auto-scroll-line-anchor-value {
    color: #555;
}
.light-theme .settings-tile {
    border-color: #ccc;
    background: rgba(0, 0, 0, 0.03);
}
.light-theme .auto-scroll-advanced[open] {
    background: rgba(0, 0, 0, 0.08);
}

/* Inline row for click highlight options */
.setting-inline-row { display: flex; flex-wrap: wrap; gap: 1.25rem 2rem; margin-bottom: 0.75rem; }
.setting-inline-row .setting-item.mini { margin: 0; display: flex; align-items: center; gap: 0.6rem; flex: 1 1 auto; min-width: 12rem; }
.setting-inline-row .setting-item.mini label { margin: 0; white-space: nowrap; }
.setting-inline-row .setting-item.mini .input-with-button { margin-left: auto; flex: 0 0 auto; }
/* Inline pause color picker variant */
.copy-color-btn { padding: 0.4em; line-height: 1; background-color: #4a4a4a; color: #eee; border: none; border-radius: 0.25rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; }
.copy-color-btn:hover { background-color: #5a5a5a; }
.light-theme .copy-color-btn { background-color: #dcdcdc; color: #333; }
.light-theme .copy-color-btn:hover { background-color: #cecece; }
.modal-footer-buttons { display: flex; gap: 1rem; margin-top: 1.25rem; }
/* ++ ИЗМЕНЕНО: Добавлено box-sizing для выравнивания высоты кнопок ++ */
.modal-footer-buttons button { flex: 1; padding: 0.625rem; font-size: 1.1em; border-radius: 0.25rem; border: none; cursor: pointer; transition: background-color 0.2s, color 0.2s; box-sizing: border-box; }
#actors-modal .modal-warning { background-color: rgba(255, 193, 7, 0.15); border: 1px solid rgba(255, 193, 7, 0.6); color: #ffca28; padding: 0.75rem; border-radius: 0.375rem; font-size: 0.95em; margin-bottom: 0.75rem; display: block; width: 100%; box-sizing: border-box; }
#actors-modal .modal-warning code { background: rgba(255, 193, 7, 0.12); color: #ffe082; padding: 0 0.35rem; border-radius: 0.25rem; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; font-size: 0.95em; }
#save-settings-button { background-color: #007acc; color: white; }
#save-settings-button:hover { background-color: #006bb3; }
.button-danger { background-color: #b02a37; color: #fff; }
.button-danger:hover { background-color: #dc3545; color: #fff; }
.light-theme .button-danger { background-color: #f7d7d9; color: #6b141d; }
.light-theme .button-danger:hover { background-color: #dc3545; color: #fff; }

/* ===== Actors coloring modal ===== */
#actors-modal .modal-content { max-width: 50rem; }
textarea#actor-role-mapping-text { width: 100%; box-sizing: border-box; resize: vertical; background-color: #333; color: #eee; border: 1px solid #555; border-radius: 4px; padding: 0.5em; font-family: monospace; font-size: 0.9em; }
.actor-color-list { display: flex; flex-direction: column; gap: 0.75rem; }
.actor-color-item { display: grid; grid-template-columns: minmax(12rem, 1fr) minmax(0, 1.2fr) auto auto; grid-template-rows: auto auto; grid-template-areas: "label roles picker delete" "filters roles picker delete"; gap: 0.4rem 0.75rem; background: #2b2b2b; padding: 0.75rem; border-radius: 0.5rem; transition: opacity 0.2s ease, box-shadow 0.2s ease; }
.light-theme .actor-color-item { background: #ddd; }
.actor-color-item-label { grid-area: label; font-weight: 600; display: flex; align-items: center; }
.actor-filter-controls { grid-area: filters; display: flex; gap: 0.5rem; align-items: center; }
.actor-color-item-roles { grid-area: roles; font-size: 0.82em; opacity: 0.8; align-self: start; }
.actor-color-picker { grid-area: picker; display: flex; align-items: center; justify-self: end; }
.actor-color-picker .actor-color-input { width: 8rem; background-color: #333; color: #eee; border: 1px solid #555; border-radius: 4px; padding: 0.5em; font-size: inherit; }
.light-theme .actor-color-picker .actor-color-input { background-color: #e9e9e9; color: #111; border-color: #ccc; }
.actor-color-item .sp-replacer { padding: 0; background: transparent; border: 0; display: flex; align-items: center; }
.actor-color-picker .sp-replacer { margin-left: 0.5rem; }
.actor-color-item .sp-preview { width: 2.5rem; height: 2.5rem; border-radius: 4px; border: 1px solid #555; margin-right: 0.4rem; }
.light-theme .actor-color-item .sp-preview { border-color: #ccc; }
.actor-color-item .sp-preview-inner,
.actor-color-item .sp-alpha-inner { border-radius: 3px; }
.actor-color-item .delete-actor-color { grid-area: delete; background: #444; color: #eee; border: none; border-radius: 0.25rem; padding: 0.4em; cursor: pointer; align-self: center; display: flex; align-items: center; justify-content: center; }
.actor-color-item .delete-actor-color:hover { background: #c0392b; }
.light-theme .actor-color-item .delete-actor-color { background: #bbb; color: #222; }
.light-theme .actor-color-item .delete-actor-color:hover { background: #e74c3c; color: #fff; }
.actor-filter-btn { width: 2.1rem; height: 2.1rem; border-radius: 0.35rem; border: 1px solid #555; background: #3a3a3a; color: #c9c9c9; font-weight: 700; font-size: 0.95rem; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease; }
.actor-filter-btn:hover { background: #4a4a4a; }
.actor-filter-btn[aria-pressed="true"] { background: #242424; color: #f0f0f0; }
.actor-filter-btn-mute[aria-pressed="true"] { color: #ff4d4f; border-color: #ff4d4f; }
.actor-filter-btn-solo[aria-pressed="true"] { color: #ffd462; border-color: #ffd462; }
.light-theme .actor-filter-btn { background: #efefef; color: #404040; border-color: #bdbdbd; }
.light-theme .actor-filter-btn:hover { background: #dedede; }
.light-theme .actor-filter-btn[aria-pressed="true"] { background: #f6f6d6; }
.light-theme .actor-filter-btn-mute[aria-pressed="true"] { color: #d84040; border-color: #d84040; }
.light-theme .actor-filter-btn-solo[aria-pressed="true"] { color: #d0a600; border-color: #d0a600; }
.actor-color-item.is-muted .actor-color-item-label,
.actor-color-item.is-muted .actor-color-item-roles,
.actor-color-item.is-muted .actor-color-picker,
.actor-color-item.is-muted .delete-actor-color { opacity: 0.4; }
.actor-color-item.is-solo-dimmed .actor-color-item-label,
.actor-color-item.is-solo-dimmed .actor-color-item-roles,
.actor-color-item.is-solo-dimmed .actor-color-picker,
.actor-color-item.is-solo-dimmed .delete-actor-color { opacity: 0.4; }
.actor-color-list.solo-mode-active .actor-filter-btn { opacity: 0.35; }
.actor-color-list.solo-mode-active .actor-filter-btn-solo[aria-pressed="true"] { opacity: 1; }
.actor-color-item.is-solo-active { opacity: 1; box-shadow: 0 0 0 1px rgba(255, 212, 98, 0.35); }
.light-theme .actor-color-item.is-solo-active { box-shadow: 0 0 0 1px rgba(208, 166, 0, 0.45); }
.actor-color-item .color-preview-box { width: 2rem; height: 2rem; border-radius: 0.4rem; border: 1px solid #555; }
@media (max-width: 720px) {
    .actor-color-item { grid-template-columns: 1fr; grid-template-areas: "label" "filters" "roles" "picker" "delete"; justify-items: stretch; }
    .actor-color-picker { justify-self: stretch; }
    .actor-color-picker .actor-color-input { width: 100%; }
    .actor-filter-controls { justify-content: flex-start; }
}

.role-filter-section { margin-top: 0.75rem; border: 1px solid #3a3a3a; border-radius: 0.5rem; background: #252525; overflow: hidden; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
.role-filter-section[open] { box-shadow: 0 0 0 1px rgba(255, 212, 98, 0.08); }
.role-filter-summary { cursor: pointer; list-style: none; display: flex; align-items: center; gap: 0.55rem; padding: 0.6rem 0.75rem; font-weight: 600; color: #e0e0e0; }
.role-filter-summary::-webkit-details-marker { display: none; }
.role-filter-summary-leading-icon { display: inline-flex; align-items: center; justify-content: center; width: 1.25rem; height: 1.25rem; color: #ffd462; }
.role-filter-summary-leading-icon .icon-svg { width: 100%; height: 100%; }
.role-filter-summary-label { display: inline-flex; align-items: center; gap: 0.3rem; font-weight: 600; }
.role-filter-summary-label.has-selection { color: #ffd462; }
.role-filter-count { display: none; font-size: 0.9em; color: inherit; }
.role-filter-count.is-visible { display: inline; }
.role-filter-summary-toggle { margin-left: auto; display: inline-flex; align-items: center; justify-content: center; }
.role-filter-summary-toggle-icon { width: 1.2rem; height: 1.2rem; display: none; color: #ffd462; }
.role-filter-section[open] .role-filter-toggle-collapse { display: block; }
.role-filter-section:not([open]) .role-filter-toggle-expand { display: block; }
.role-filter-chips-wrapper { padding: 0.5rem 0.75rem 0.75rem; display: flex; flex-wrap: wrap; gap: 0.4rem; align-items: center; }
.role-filter-chips { display: flex; flex-wrap: wrap; gap: 0.4rem; flex: 1 1 auto; min-width: 0; }
.role-filter-chip { background: #333; color: #ddd; border: 1px solid #4a4a4a; border-radius: 999px; padding: 0.35rem 0.8rem; cursor: pointer; font-size: 0.85rem; line-height: 1; transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
.role-filter-chip:hover { background: #3f3f3f; }
.role-filter-chip:focus-visible { outline: none; box-shadow: 0 0 0 2px rgba(255, 212, 98, 0.35); }
.role-filter-chip.is-active { background: rgba(255, 212, 98, 0.18); border-color: #ffd462; color: #ffd462; box-shadow: 0 0 0 1px rgba(255, 212, 98, 0.35); }
.role-filter-chip.is-muted { opacity: 0.45; }
.role-filter-chip.is-disabled,
.role-filter-chip[disabled] { pointer-events: none; cursor: not-allowed; opacity: 0.3; background: #2a2a2a; color: #777; border-color: #3a3a3a; box-shadow: none; }
.role-filter-empty { font-size: 0.85rem; color: #777; padding: 0.25rem 0; }
.role-filter-reset { display: inline-flex; align-items: center; gap: 0.4rem; background: transparent; border: 1px solid #4a4a4a; border-radius: 999px; color: #ffd462; padding: 0.35rem 0.9rem; font-size: 0.85rem; line-height: 1; cursor: pointer; transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease; margin-left: auto; }
.role-filter-reset-icon { display: inline-flex; align-items: center; justify-content: center; }
.role-filter-reset-icon .icon-svg { width: 1rem; height: 1rem; }
.role-filter-reset:hover { background: rgba(255, 212, 98, 0.08); }
.role-filter-reset:focus-visible { outline: none; box-shadow: 0 0 0 2px rgba(255, 212, 98, 0.35); }
.role-filter-reset[hidden] { display: none !important; }
.light-theme .role-filter-section { background: #f2f2f2; border-color: #cfcfcf; }
.light-theme .role-filter-section[open] { box-shadow: 0 0 0 1px rgba(208, 166, 0, 0.12); }
.light-theme .role-filter-summary { color: #333; }
.light-theme .role-filter-summary-leading-icon { color: #d0a600; }
.light-theme .role-filter-summary-label.has-selection { color: #d0a600; }
.light-theme .role-filter-summary-toggle-icon { color: #d0a600; }
.light-theme .role-filter-chip { background: #f7f7f7; color: #444; border-color: #c8c8c8; }
.light-theme .role-filter-chip:hover { background: #ececec; }
.light-theme .role-filter-chip.is-active { background: rgba(208, 166, 0, 0.18); border-color: #d0a600; color: #d0a600; box-shadow: 0 0 0 1px rgba(208, 166, 0, 0.3); }
.light-theme .role-filter-chip.is-muted { opacity: 0.5; }
.light-theme .role-filter-chip.is-disabled,
.light-theme .role-filter-chip[disabled] { background: #e5e5e5; border-color: #cdcdcd; color: #9c9c9c; opacity: 0.35; }
.light-theme .role-filter-empty { color: #777; }
.light-theme .role-filter-reset { border-color: #d0a600; color: #a57700; }
.light-theme .role-filter-reset:hover { background: rgba(208, 166, 0, 0.12); }

/* Unassigned roles list */
.unassigned-roles-list { display: flex; flex-wrap: wrap; gap: 0.4rem; padding: 0.25rem 0; }
.unassigned-role-chip { background: #444; color: #eee; padding: 0.25rem 0.55rem; border-radius: 1rem; font-size: 0.75em; line-height: 1; white-space: nowrap; cursor: default; opacity: 0.9; }
.unassigned-role-chip.newly-unassigned { outline: 1px solid #888; }
.light-theme .unassigned-role-chip { background: #ccc; color: #222; }

/* Stats modal */
.stats-table { width: 100%; border-collapse: collapse; margin: 0.75rem 0 1.5rem; font-size: 0.85em; }
.stats-table th, .stats-table td { padding: 0.4rem 0.5rem; text-align: left; border-bottom: 1px solid #444; }
.stats-table th { background: #333; position: sticky; top: 0; }
.light-theme .stats-table th { background: #e0e0e0; }
.stats-table tbody tr:nth-child(even) { background: rgba(255,255,255,0.03); }
.light-theme .stats-table tbody tr:nth-child(even) { background: rgba(0,0,0,0.05); }
.stats-table tfoot th { background: #2a2a2a; }
.light-theme .stats-table tfoot th { background: #d5d5d5; }


/* ===================== Responsive Layout ===================== */
/* NOTE: Removed all responsive font-size reductions. Font sizing is now solely controlled by user uiScale and base styles.
         Below media queries retain ONLY structural adjustments (layout flow & scrolling) without touching font-size. */
/* Basic safety: allow children to shrink properly */
.panel-controls > * { min-width: 0; }

/* Structural only: (former 900px breakpoint) retain padding tweak WITHOUT font-size changes */
@media (max-width: 900px) {
    #navigation-panel { padding: 0.75rem 0.75rem 0.9rem; }
    #transport-timecode { letter-spacing: 0.05rem; }
    /* Allow checkerboard pairs to wrap on narrower viewports */
    .checkerboard-pair-row { flex-wrap: wrap; }
    .checkerboard-cell { flex: 1 1 15rem; }
}

/* Very narrow / compact mode: collapse header layout (no font-size adjustments) */
@media (max-width: 680px) {
    .panel-header { flex-direction: column; align-items: flex-start; gap: 0.4rem; }
    #status-indicator { text-align: left; }
    .controls-left label { display: none; }
    #track-selector { max-width: 100%; }
    /* Aggressive wrapping for very narrow devices */
    .checkerboard-pair-row { flex-wrap: wrap; }
    .checkerboard-cell { flex: 1 1 14rem; }
}

/* Extreme narrow: allow panel horizontal scrolling instead of overflow clipping */
@media (max-width: 520px) {
    .panel-controls { overflow-x: auto; flex-wrap: nowrap; }
    .panel-controls::-webkit-scrollbar { height: 0.5rem; }
    .panel-controls::-webkit-scrollbar-track { background: #2e2e2e; }
    .panel-controls::-webkit-scrollbar-thumb { background: #555; border-radius: 0.25rem; }
    .panel-controls::-webkit-scrollbar-thumb:hover { background: #666; }
    .controls-left, .controls-right, #transport-status { flex-basis: auto; flex-grow: 0; }
    .checkerboard-pair-row { flex-wrap: wrap; }
    .checkerboard-cell { flex: 1 1 12rem; }
}

/* Light theme adjustments for scrollbars (WebKit) */
@media (max-width: 520px) {
    .light-theme .panel-controls::-webkit-scrollbar-track { background: #f5f5f5; }
    .light-theme .panel-controls::-webkit-scrollbar-thumb { background: #bbb; }
    .light-theme .panel-controls::-webkit-scrollbar-thumb:hover { background: #999; }
}
/* ============================================================= */
# FRZZ Reaper Web Prompter

Интерактивный текстовый монитор / телесуфлёр для REAPER с двумя режимами работы: встроенное окно (через расширение `reaper_webview`) и доступ по локальной сети из любого браузера.

## Оглавление
1. [Возможности](#возможности)
2. [Скриншот / Визуал (placeholder)](#скриншот--визуал)
3. [Архитектура и компоненты](#архитектура-и-компоненты)
4. [Установка](#установка)
   1. [Быстрая установка через инсталлер](#быстрая-установка-через-инсталлер)
   2. [Ручная установка](#ручная-установка)
5. [Первый запуск](#первый-запуск)
6. [Режимы использования](#режимы-использования)
   1. [Встроенный WebView внутри REAPER](#встроенный-webview-внутри-reaper)
   2. [Открытие в браузере по сети](#открытие-в-браузере-по-сети)
7. [Настройки и поведение](#настройки-и-поведение)
   1. [Основные параметры](#основные-параметры)
   2. [Цветовая модель ролей / актёров](#цветовая-модель-ролей--актёров)
   3. [Checkerboard режим](#checkerboard-режим)
8. [Структура репозитория](#структура-репозитория)
9. [Обновление](#обновление)
10. [Известные ограничения](#известные-ограничения)
11. [Roadmap (кратко)](#roadmap-кратко)
12. [Отладка и диагностика](#отладка-и-диагностика)
13. [Частые вопросы](#частые-вопросы)
14. [Лицензия](#лицензия)

## Возможности
- Отображение текста с ролями и цветовой дифференциацией.
- Поддержка раскраски актёров и приоритетов (цвет актёра выше цвета строки).
- Автоматическая и ручная прокрутка.
- Центрирование активной строки / плавная подсветка.
- Масштаб интерфейса (UI Scale) и адаптивная вёрстка под планшеты.
- Настраиваемые шрифты, размеры, интервалы и панель управления.
- Мгновенная синхронизация названия проекта REAPER в заголовке (с ретраями).
- Режимы шахматной подложки (checkerboard) для повышения читаемости.
- Доступ из локальной сети (любой девайс с браузером) при включённом веб-сервере REAPER.
- Интеграция с транспортом REAPER (таймкод / позиция / управление).

## Скриншот / Визуал
(Добавить позже — placeholder.)

## Архитектура и компоненты
Проект состоит из двух основных частей:
1. Lua-скрипты (каталог `Scripts/`):
   - `FRZZ_web_prompter.lua` — точка запуска (frontend окно / подключение к WebView).
   - `FRZZ_web_prompter_backend.lua` — backend: обработка текста, ролей, взаимодействие с REAPER (ExtState / команды).
2. Web-интерфейс (каталог `reaper_www_root/`):
   - `prompter.html` — каркас страницы.
   - `script.js` — логика UI, синхронизация, отрисовка, прокрутка, подсветка.
   - `style.css` — оформление и адаптив.
   - `jquery.min.js`, `spectrum.js`, `spectrum.css` — внешние зависимости (не модифицировать).
3. Дополнительно:
   - `UserPlugins/` — бинарь плагина `reaper_webview` (для встроенного режима) и `WebView2Loader.dll` (Windows).
   - `installer.py` — автоматический установщик (копирование файлов + настройка действий + опциональная настройка веб-сервера в `reaper.ini`).

## Установка
### Быстрая установка через инсталлер
1. Скачайте релизный архив / одиночный бинарный инсталлер (`.exe` на Windows / `.command` на macOS).
2. Запустите.
3. Подтвердите путь к папке ресурсов REAPER (обычно определяется автоматически).
4. Дождитесь копирования скриптов, web-ресурсов и плагина (если присутствует в сборке).
5. (Опционально) Согласитесь на автоматическое добавление web-интерфейса (HTTP) в `reaper.ini` — будет создан `csurf_*` блок.
6. Перезапустите REAPER.

После установки появятся два действия в Action List:
- `Custom: Web Prompter Backend`
- `Custom: Web Prompter Launch`

### Ручная установка
1. Скопируйте каталоги `Scripts/`, `reaper_www_root/` и (при необходимости) `UserPlugins/` в папку ресурсов REAPER:
   - Windows: `%APPDATA%/REAPER`
   - macOS: `~/Library/Application Support/REAPER`
2. Добавьте строки действий в `reaper-kb.ini` (если не хотите запускать инсталлер):
```
SCR 4 0 FRZZ_WEB_NOTES_READER "Custom: Web Prompter Backend" FRZZ_web_prompter_backend.lua
SCR 4 0 FRZZ_NOTES_READER_LAUNCH "Custom: Web Prompter Launch" FRZZ_web_prompter.lua
```
3. (Опционально) Настройте веб-сервер в `reaper.ini` (параметры `csurf_cnt` и `csurf_*` с упоминанием `prompter.html`).
4. Перезапустите REAPER.

## Первый запуск
1. Выполните действие `Web Prompter Backend` (если backend не запускается автоматически из Launch).
2. Выполните `Web Prompter Launch`.
3. Должно открыться окно со строками текста.
4. Проверьте корректность отображения ролей и подсветки.

## Режимы использования
### Встроенный WebView внутри REAPER
- Требует установленного расширения `reaper_webview` (идёт в комплекте или ставится отдельно).
- Окно открывается внутри REAPER, не требуя внешний браузер.

### Открытие в браузере по сети
1. Убедитесь, что в `reaper.ini` настроен HTTP csurf для `prompter.html`.
2. Откройте адрес `http://localhost:PORT` или `http://LAN_IP:PORT` (IP локальной машины).
3. Интерфейс идентичен встроенному, при активном backend обновления поступают синхронно.

## Настройки и поведение
### Основные параметры
(Список может расширяться) Примеры:
- Масштаб интерфейса (UI Scale)
- Размер шрифта текста / ролей
- Интерлиньяж / вертикальные отступы
- Скорость авто‑скролла
- Включение/отключение подсветки активной строки
- Семейство шрифта
- Режим отображения панели управления (адаптивный wrap)

### Цветовая модель ролей / актёров
- Приоритет: цвет актёра перекрывает цвет строки.
- Роли парсятся и собираются в карты (role → lines, actor → mapping).
- Избегается дублирование и конфликт подсветок.
- Глобальные настройки цветов сохраняются через backend (ExtState, chunked JSON).

### Checkerboard режим
Доступны варианты:
1. Выключен
2. По ролям
3. По уникальным цветам ролей
Используется для повышения читаемости блоков текста при длинных скриптах.

## Структура репозитория
```
Scripts/                    # Lua backend и launch скрипты
reaper_www_root/            # Веб-интерфейс (HTML/JS/CSS + внешние библиотеки)
UserPlugins/                # Плагин reaper_webview и зависимости (опционально для релизов)
installer.py                # Автоматический установщик
KeyMaps/                    # (Если есть преднастроенные keymap файлы)
README.md                   # Этот файл
LICENSE                     # MIT лицензия
```

## Обновление
1. Скачайте новую версию (инсталлер или архив).
2. Поверх скопируйте `Scripts/`, `reaper_www_root/`, при необходимости обновите `UserPlugins/`.
3. Перезапустите REAPER.
4. Настройки (цвета, роли) сохранятся автоматически (persist через ExtState / JSON).

## Известные ограничения
- Нет встроенного редактирования текста «на лету» (редактирование через исходные данные проекта / внешние файлы).
- Нет пока импорта форматов субтитров (.srt, .ass) — в планах.
- Нет режима зеркала (flip) — предложено как потенциальная функция.
- Требуется стабильный WebView движок (на Windows — WebView2 Runtime).

## Roadmap (кратко)
(Сокращённо, детальный roadmap вне этого файла):
- Поддержка импорта форматов (srt / ass)
- Продвинутые статистики / отчёты
- Расширенные фильтры ролей и группировка
- Темы (dark/light auto)
- Режим зеркала

## Отладка и диагностика
- При проблемах с отображением убедитесь, что backend запущен.
- Проверяйте наличие записи о `prompter.html` в `reaper.ini` (csurf_* строки).
- В случае артефактов раскраски — перезапустите окно (закрыть/открыть Launch script).
- Если не обновляется название проекта — сохраните проект в REAPER (формирование имени).
- Для встроенного режима: проверьте загрузку `reaper_webview` в меню Extensions.

## Частые вопросы
**Q:** Ничего не отображается, пустое окно.  
**A:** Проверьте, запущен ли backend (действие Backend). Убедитесь, что текст доступен/подгружен.

**Q:** Не определились роли в текстовом мониторе.
**A:** Проверьте, находятся ли они на отдельной строке как текстовые итемы, сами роли должны находится в начале первой строки в блоке `[РОЛЬ]`. Данный текстовый монитор не читает данные из SWS Notes, регионов и маркеров.

**Q:** Где хранятся настройки?  
**A:** Настройки текстового монитора хранятся в reaper_www_root (`settings.json`) рядом с файлами монитора + файлы ролей (`<project>-roles.json`) рядом с файлом проекта.

**Q:** Можно ли открыть на планшете?  
**A:** Да, при настроенном HTTP csurf в `reaper.ini` и доступности порта в сети.

## Лицензия
MIT License — см. файл `LICENSE`.
